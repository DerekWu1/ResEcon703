\documentclass[11pt,letterpaper]{article}\usepackage[]{graphicx}\usepackage[]{color}
% maxwidth is the original width if it is less than linewidth
% otherwise use linewidth (to make sure the graphics do not exceed the margin)
\makeatletter
\def\maxwidth{ %
  \ifdim\Gin@nat@width>\linewidth
    \linewidth
  \else
    \Gin@nat@width
  \fi
}
\makeatother

\definecolor{fgcolor}{rgb}{0.345, 0.345, 0.345}
\newcommand{\hlnum}[1]{\textcolor[rgb]{0.686,0.059,0.569}{#1}}%
\newcommand{\hlstr}[1]{\textcolor[rgb]{0.192,0.494,0.8}{#1}}%
\newcommand{\hlcom}[1]{\textcolor[rgb]{0.678,0.584,0.686}{\textit{#1}}}%
\newcommand{\hlopt}[1]{\textcolor[rgb]{0,0,0}{#1}}%
\newcommand{\hlstd}[1]{\textcolor[rgb]{0.345,0.345,0.345}{#1}}%
\newcommand{\hlkwa}[1]{\textcolor[rgb]{0.161,0.373,0.58}{\textbf{#1}}}%
\newcommand{\hlkwb}[1]{\textcolor[rgb]{0.69,0.353,0.396}{#1}}%
\newcommand{\hlkwc}[1]{\textcolor[rgb]{0.333,0.667,0.333}{#1}}%
\newcommand{\hlkwd}[1]{\textcolor[rgb]{0.737,0.353,0.396}{\textbf{#1}}}%
\let\hlipl\hlkwb

\usepackage{framed}
\makeatletter
\newenvironment{kframe}{%
 \def\at@end@of@kframe{}%
 \ifinner\ifhmode%
  \def\at@end@of@kframe{\end{minipage}}%
  \begin{minipage}{\columnwidth}%
 \fi\fi%
 \def\FrameCommand##1{\hskip\@totalleftmargin \hskip-\fboxsep
 \colorbox{shadecolor}{##1}\hskip-\fboxsep
     % There is no \\@totalrightmargin, so:
     \hskip-\linewidth \hskip-\@totalleftmargin \hskip\columnwidth}%
 \MakeFramed {\advance\hsize-\width
   \@totalleftmargin\z@ \linewidth\hsize
   \@setminipage}}%
 {\par\unskip\endMakeFramed%
 \at@end@of@kframe}
\makeatother

\definecolor{shadecolor}{rgb}{.97, .97, .97}
\definecolor{messagecolor}{rgb}{0, 0, 0}
\definecolor{warningcolor}{rgb}{1, 0, 1}
\definecolor{errorcolor}{rgb}{1, 0, 0}
\newenvironment{knitrout}{}{} % an empty environment to be redefined in TeX

\usepackage{alltt}

\usepackage[top=1in, 
left=1in, 
right=1in, 
bottom=1in]{geometry}
\usepackage{setspace}
\usepackage{titling}
\newcommand{\subtitle}[1]{%
	\posttitle{%
		\par\end{center}
	\begin{center}\large#1\end{center}
	\vskip0.5em}%
}

\usepackage[T1]{fontenc} 
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\renewcommand{\familydefault}{\sfdefault}

\usepackage{booktabs,caption,threeparttable}

\usepackage[hyperfootnotes=false, 
colorlinks=true, 
allcolors=black]{hyperref}

\usepackage{enumitem}
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\begin{document}


\title{Problem Set 4}
\subtitle{Topics in Advanced Econometrics (ResEcon 703)\\University of Massachusetts Amherst}
\author{\textbf{Solutions}}
\date{\vspace{-5ex}}

\maketitle

\section*{Rules}

Email a single .pdf file of your problem set writeup, code, and output to \href{mailto:mwoerman@umass.edu}{\texttt{mwoerman@umass.edu}} by the date and time above. You may work in groups of up to three, and all group members can submit the same code and output; indicate in your writeup who you worked with. You must submit a unique writeup that answers the problems below. You can discuss answers with your fellow group members, but your writeup must be in your own words. Problem 1 allows you to use R's ``canned routines,'' while Problem 2 requires you to code your own estimators and write your own simulation code. Each problem will indicate which R function to use.

\section*{Data}

Download the file \href{https://github.com/woerman/ResEcon703/blob/master/problem_set_4/ps4_dataset.zip}{\texttt{ps4\_dataset.zip}} from the \href{https://github.com/woerman/ResEcon703}{course website (\texttt{github.com/woerman/ResEcon703})}. This zipped file contains the dataset, \texttt{phones.csv}, that you will use for this problem set. The dataset contains simulated data from 1000 customers on the purchases or pre-orders of highly-anticipated phone models recently released by Apple and Google: iPhone 11 and Pixel 4. See the file \texttt{data\_descriptions.txt} for descriptions of the variables in the dataset.

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlcom{### Load packages for problem set}
\hlkwd{library}\hlstd{(tidyverse)}
\end{alltt}


{\ttfamily\noindent\itshape\color{messagecolor}{\#\# -- Attaching packages ------------------------------------------- tidyverse 1.2.1 --}}

{\ttfamily\noindent\itshape\color{messagecolor}{\#\# v ggplot2 3.2.1\ \ \ \  v purrr\ \  0.3.3\\\#\# v tibble\ \ 2.1.3\ \ \ \  v dplyr\ \  0.8.3\\\#\# v tidyr\ \  1.0.0\ \ \ \  v stringr 1.4.0\\\#\# v readr\ \  1.3.1\ \ \ \  v forcats 0.4.0}}

{\ttfamily\noindent\itshape\color{messagecolor}{\#\# -- Conflicts ---------------------------------------------- tidyverse\_conflicts() --\\\#\# x dplyr::filter() masks stats::filter()\\\#\# x dplyr::lag()\ \ \ \ masks stats::lag()}}\begin{alltt}
\hlkwd{library}\hlstd{(mlogit)}
\end{alltt}


{\ttfamily\noindent\itshape\color{messagecolor}{\#\# Loading required package: Formula}}

{\ttfamily\noindent\itshape\color{messagecolor}{\#\# Loading required package: zoo}}

{\ttfamily\noindent\itshape\color{messagecolor}{\#\# \\\#\# Attaching package: 'zoo'}}

{\ttfamily\noindent\itshape\color{messagecolor}{\#\# The following objects are masked from 'package:base':\\\#\# \\\#\#\ \ \ \  as.Date, as.Date.numeric}}

{\ttfamily\noindent\itshape\color{messagecolor}{\#\# Loading required package: lmtest}}\end{kframe}
\end{knitrout}

\section*{Problem 1: Mixed Logit Model}

\begin{enumerate}[label=\alph*., leftmargin=*]
	\item We are again interested in understanding how consumers value two phone characteristics: internal storage and screen size. As we saw in the last problem set, consumers appear to have brand preferences, which we are also interested in valuing. Model the purchase of a phone as a mixed logit model. Include an Apple brand dummy, the amount of storage, the screen size, and the price of each phone as explanatory variables with random coefficients. That is, the representative utility for alternative $j$ is
	$$V_{nj} = \beta_0 Apple_j + \beta_1 GB_j + \beta_2 SS_j + \beta_3 p_j$$
	where $Apple_j$ is a dummy variable if alternative $j$ is from Apple, $GB_j$ is the internal storage of alternative $j$, $SS_j$ is the diagonal screen size of alternative $j$, and $p_j$ is the price of alternative $j$. Model all four random coefficients as having a normal distribution. Estimate this mixed logit model using the \texttt{mlogit()} function in R; use 100 draws for simulation (\texttt{R = 100}) and set a seed of 703 for replication (\texttt{seed = 703}).
	\begin{enumerate}[label=\roman*.]
		\item Report your parameter estimates, standard errors, z-stats, and p-values. Briefly interpret these results. 
		\item For each coefficient, calculate the proportion of the population with negative coefficients and the proportion of the population with positive coefficients. Describe whether these coefficient distributions match economic intuition.
	\end{enumerate}

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlcom{### Part a}
\hlcom{## Load dataset}
\hlstd{phones} \hlkwb{<-} \hlkwd{read_csv}\hlstd{(}\hlstr{'phones.csv'}\hlstd{)}
\end{alltt}


{\ttfamily\noindent\itshape\color{messagecolor}{\#\# Parsed with column specification:\\\#\# cols(\\\#\#\ \  customer\_id = col\_double(),\\\#\#\ \  phone\_id = col\_double(),\\\#\#\ \  purchase = col\_double(),\\\#\#\ \  phone = col\_character(),\\\#\#\ \  storage = col\_double(),\\\#\#\ \  screen = col\_double(),\\\#\#\ \  price = col\_double()\\\#\# )}}\begin{alltt}
\hlcom{## Create dummy variable for Apple}
\hlstd{data_1} \hlkwb{<-} \hlstd{phones} \hlopt{%>%}
  \hlkwd{mutate}\hlstd{(}\hlkwc{apple} \hlstd{=} \hlnum{1} \hlopt{*} \hlstd{(phone_id} \hlopt{%in%} \hlnum{5}\hlopt{:}\hlnum{10}\hlstd{))}
\hlcom{## Convert dataset to mlogit format}
\hlstd{data_1a} \hlkwb{<-} \hlstd{data_1} \hlopt{%>%}
  \hlkwd{mlogit.data}\hlstd{(}\hlkwc{shape} \hlstd{=} \hlstr{'long'}\hlstd{,} \hlkwc{choice} \hlstd{=} \hlstr{'purchase'}\hlstd{,} \hlkwc{alt.var} \hlstd{=} \hlstr{'phone_id'}\hlstd{)}
\end{alltt}


{\ttfamily\noindent\color{warningcolor}{\#\# Warning: Setting row names on a tibble is deprecated.}}\begin{alltt}
\hlcom{## Model phone purchase as a mixed logit with normal coefficients}
\hlstd{model_1a} \hlkwb{<-} \hlstd{data_1a} \hlopt{%>%}
  \hlkwd{mlogit}\hlstd{(purchase} \hlopt{~} \hlstd{apple} \hlopt{+} \hlstd{storage} \hlopt{+} \hlstd{screen} \hlopt{+} \hlstd{price} \hlopt{|} \hlnum{0} \hlopt{|} \hlnum{0}\hlstd{,} \hlkwc{data} \hlstd{= .,}
         \hlkwc{rpar} \hlstd{=} \hlkwd{c}\hlstd{(}\hlkwc{apple} \hlstd{=} \hlstr{'n'}\hlstd{,} \hlkwc{storage} \hlstd{=} \hlstr{'n'}\hlstd{,} \hlkwc{screen} \hlstd{=} \hlstr{'n'}\hlstd{,} \hlkwc{price} \hlstd{=} \hlstr{'n'}\hlstd{),}
         \hlkwc{R} \hlstd{=} \hlnum{100}\hlstd{,} \hlkwc{seed} \hlstd{=} \hlnum{703}\hlstd{)}
\hlcom{## Summarize model results}
\hlstd{model_1a} \hlopt{%>%}
  \hlkwd{summary}\hlstd{()}
\end{alltt}
\begin{verbatim}
## 
## Call:
## mlogit(formula = purchase ~ apple + storage + screen + price | 
##     0 | 0, data = ., rpar = c(apple = "n", storage = "n", screen = "n", 
##     price = "n"), R = 100, seed = 703)
## 
## Frequencies of alternatives:
##     1     2     3     4     5     6     7     8     9    10 
## 0.073 0.008 0.078 0.005 0.208 0.355 0.009 0.081 0.014 0.169 
## 
## bfgs method
## 34 iterations, 0h:0m:28s 
## g'(-H)^-1g = 2.33E-07 
## gradient close to zero 
## 
## Coefficients :
##               Estimate  Std. Error  z-value  Pr(>|z|)    
## apple      -0.27432806  0.18745159  -1.4635    0.1433    
## storage     0.01575859  0.00110029  14.3222 < 2.2e-16 ***
## screen      3.32983065  0.37194887   8.9524 < 2.2e-16 ***
## price      -0.01364835  0.00099822 -13.6727 < 2.2e-16 ***
## sd.apple   -0.39293068  0.65101653  -0.6036    0.5461    
## sd.storage  0.01030173  0.00120933   8.5185 < 2.2e-16 ***
## sd.screen   4.38053637  0.77092870   5.6822  1.33e-08 ***
## sd.price   -0.00102265  0.00130528  -0.7835    0.4334    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Log-Likelihood: -1795.8
## 
## random coefficients
##         Min.      1st Qu.      Median        Mean      3rd Qu. Max.
## apple   -Inf -0.539355773 -0.27432806 -0.27432806 -0.009300343  Inf
## storage -Inf  0.008810186  0.01575859  0.01575859  0.022707003  Inf
## screen  -Inf  0.375203765  3.32983065  3.32983065  6.284457530  Inf
## price   -Inf -0.014338119 -0.01364835 -0.01364835 -0.012958582  Inf
\end{verbatim}
\begin{alltt}
\hlcom{## Calculate fraction of population with negative coefficients}
\hlkwd{pnorm}\hlstd{(}\hlnum{0}\hlstd{, model_1a}\hlopt{$}\hlstd{coefficients[}\hlnum{1}\hlopt{:}\hlnum{4}\hlstd{],} \hlkwd{abs}\hlstd{(model_1a}\hlopt{$}\hlstd{coefficients[}\hlnum{5}\hlopt{:}\hlnum{8}\hlstd{]))}
\end{alltt}
\begin{verbatim}
##      apple    storage     screen      price 
## 0.75746109 0.06304496 0.22358479 1.00000000
\end{verbatim}
\begin{alltt}
\hlcom{## Calculate fraction of population with positive coefficients}
\hlnum{1} \hlopt{-} \hlkwd{pnorm}\hlstd{(}\hlnum{0}\hlstd{, model_1a}\hlopt{$}\hlstd{coefficients[}\hlnum{1}\hlopt{:}\hlnum{4}\hlstd{],} \hlkwd{abs}\hlstd{(model_1a}\hlopt{$}\hlstd{coefficients[}\hlnum{5}\hlopt{:}\hlnum{8}\hlstd{]))}
\end{alltt}
\begin{verbatim}
##     apple   storage    screen     price 
## 0.2425389 0.9369550 0.7764152 0.0000000
\end{verbatim}
\end{kframe}
\end{knitrout}

	Neither parameter for the $\beta_0$ distribution is significant, suggesting no brand preference in this model. Parameters for $\beta_1$ and $\beta_2$ are significant, indicating that preferences for internal storage and screen size vary throughout the population. The mean parameter for $\beta_3$ is significant but not the standard deviation, suggesting no variation in the marginal utility of income. The distributions of these coefficients is mostly intuitive. Coefficients $\beta_0$ and $\beta_2$ have substantial mass on both the positive and negative sides; some consumers prefer Apple phones and others prefer Google, and some consumers prefer a larger screen size and others prefer a more compact phone. Coefficient $\beta_1$ is positive for a large proportion of the population, but not for everyone, which is not intuitive because there is no clear reason to prefer less storage \emph{ceteris paribus}. Coefficient $\beta_3$ is technically negative for some consumers, but only a negligible amount, which is intuitive because we generally think everyone has a positive marginal utility of income. 

	\item The mixed logit model of (a) is not be the best model for this setting if we think some coefficients should always be positive or some coefficient should always be negative. Again model this purchase as a mixed logit model with the same underlying utility model as in (a). That is, the representative utility for alternative $j$ is
	$$V_{nj} = \beta_0 Apple_j + \beta_1 GB_j + \beta_2 SS_j + \beta_3 p_j$$
	where $Apple_j$ is a dummy variable if alternative $j$ is from Apple, $GB_j$ is the internal storage of alternative $j$, $SS_j$ is the diagonal screen size of alternative $j$, and $p_j$ is the price of alternative $j$. Model $\beta_0$ and $\beta_2$ as having a normal distribution and $\beta_1$ and $\beta_3$ as having a log-normal distribution. Estimate this mixed logit model using the \texttt{mlogit()} function in R; use 100 draws for simulation (\texttt{R = 100}) and set a seed of 703 for replication (\texttt{seed = 703}). 
	\begin{enumerate}[label=\roman*.]
		\item Report your parameter estimates, standard errors, z-stats, and p-values. Briefly interpret these results. 
		\item For each coefficient, calculate the proportion of the population with negative coefficients and the proportion of the population with positive coefficients. Describe whether these coefficient distributions match economic intuition.
	\end{enumerate}

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlcom{### Part b}
\hlcom{## Convert dataset to mlogit format with negative prices}
\hlstd{data_1b} \hlkwb{<-} \hlstd{data_1} \hlopt{%>%}
  \hlkwd{mlogit.data}\hlstd{(}\hlkwc{shape} \hlstd{=} \hlstr{'long'}\hlstd{,} \hlkwc{choice} \hlstd{=} \hlstr{'purchase'}\hlstd{,} \hlkwc{alt.var} \hlstd{=} \hlstr{'phone_id'}\hlstd{,}
              \hlkwc{opposite} \hlstd{=} \hlstr{'price'}\hlstd{)}
\end{alltt}


{\ttfamily\noindent\color{warningcolor}{\#\# Warning: Setting row names on a tibble is deprecated.}}\begin{alltt}
\hlcom{## Model phone purchase as a mixed logit with random coefficients}
\hlstd{model_1b} \hlkwb{<-} \hlstd{data_1b} \hlopt{%>%}
  \hlkwd{mlogit}\hlstd{(purchase} \hlopt{~} \hlstd{apple} \hlopt{+} \hlstd{storage} \hlopt{+} \hlstd{screen} \hlopt{+} \hlstd{price} \hlopt{|} \hlnum{0} \hlopt{|} \hlnum{0}\hlstd{,} \hlkwc{data} \hlstd{= .,}
         \hlkwc{rpar} \hlstd{=} \hlkwd{c}\hlstd{(}\hlkwc{apple} \hlstd{=} \hlstr{'n'}\hlstd{,} \hlkwc{storage} \hlstd{=} \hlstr{'ln'}\hlstd{,} \hlkwc{screen} \hlstd{=} \hlstr{'n'}\hlstd{,} \hlkwc{price} \hlstd{=} \hlstr{'ln'}\hlstd{),}
         \hlkwc{R} \hlstd{=} \hlnum{100}\hlstd{,} \hlkwc{seed} \hlstd{=} \hlnum{703}\hlstd{)}
\hlcom{## Summarize model results}
\hlstd{model_1b} \hlopt{%>%}
  \hlkwd{summary}\hlstd{()}
\end{alltt}
\begin{verbatim}
## 
## Call:
## mlogit(formula = purchase ~ apple + storage + screen + price | 
##     0 | 0, data = ., rpar = c(apple = "n", storage = "ln", screen = "n", 
##     price = "ln"), R = 100, seed = 703)
## 
## Frequencies of alternatives:
##     1     2     3     4     5     6     7     8     9    10 
## 0.073 0.008 0.078 0.005 0.208 0.355 0.009 0.081 0.014 0.169 
## 
## bfgs method
## 26 iterations, 0h:0m:20s 
## g'(-H)^-1g = 8.69E-08 
## gradient close to zero 
## 
## Coefficients :
##             Estimate Std. Error  z-value  Pr(>|z|)    
## apple      -0.180224   0.228987  -0.7870    0.4313    
## storage    -4.224395   0.072971 -57.8916 < 2.2e-16 ***
## screen      3.482946   0.396939   8.7745 < 2.2e-16 ***
## price      -4.283510   0.075627 -56.6398 < 2.2e-16 ***
## sd.apple   -0.545821   0.686927  -0.7946    0.4269    
## sd.storage  0.610595   0.061004  10.0091 < 2.2e-16 ***
## sd.screen   4.734797   0.787636   6.0114 1.839e-09 ***
## sd.price    0.069882   0.102294   0.6832    0.4945    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Log-Likelihood: -1799.5
## 
## random coefficients
##         Min.      1st Qu.      Median        Mean    3rd Qu. Max.
## apple   -Inf -0.548375347 -0.18022435 -0.18022435 0.18792664  Inf
## storage    0  0.009694127  0.01463419  0.01763303 0.02209167  Inf
## screen  -Inf  0.289374140  3.48294624  3.48294624 6.67651834  Inf
## price      0  0.013159054  0.01379415  0.01382788 0.01445991  Inf
\end{verbatim}
\begin{alltt}
\hlcom{## Calculate fraction of population with negative coefficients}
\hlkwd{c}\hlstd{(}\hlkwd{pnorm}\hlstd{(}\hlnum{0}\hlstd{, model_1b}\hlopt{$}\hlstd{coefficients[}\hlnum{1}\hlstd{],} \hlkwd{abs}\hlstd{(model_1b}\hlopt{$}\hlstd{coefficients[}\hlnum{5}\hlstd{])),}
  \hlkwd{plnorm}\hlstd{(}\hlnum{0}\hlstd{, model_1b}\hlopt{$}\hlstd{coefficients[}\hlnum{2}\hlstd{],} \hlkwd{abs}\hlstd{(model_1b}\hlopt{$}\hlstd{coefficients[}\hlnum{6}\hlstd{])),}
  \hlkwd{pnorm}\hlstd{(}\hlnum{0}\hlstd{, model_1b}\hlopt{$}\hlstd{coefficients[}\hlnum{3}\hlstd{],} \hlkwd{abs}\hlstd{(model_1b}\hlopt{$}\hlstd{coefficients[}\hlnum{7}\hlstd{])),}
  \hlkwd{plnorm}\hlstd{(}\hlnum{0}\hlstd{, model_1b}\hlopt{$}\hlstd{coefficients[}\hlnum{4}\hlstd{],} \hlkwd{abs}\hlstd{(model_1b}\hlopt{$}\hlstd{coefficients[}\hlnum{8}\hlstd{])))} \hlopt{%>%}
  \hlkwd{setNames}\hlstd{(}\hlkwd{c}\hlstd{(}\hlstr{'apple'}\hlstd{,} \hlstr{'storage'}\hlstd{,} \hlstr{'screen'}\hlstd{,} \hlstr{'price'}\hlstd{))}
\end{alltt}
\begin{verbatim}
##     apple   storage    screen     price 
## 0.6293715 0.0000000 0.2309852 0.0000000
\end{verbatim}
\begin{alltt}
\hlcom{## Calculate fraction of population with positive coefficients}
\hlnum{1} \hlopt{-} \hlkwd{c}\hlstd{(}\hlkwd{pnorm}\hlstd{(}\hlnum{0}\hlstd{, model_1b}\hlopt{$}\hlstd{coefficients[}\hlnum{1}\hlstd{],} \hlkwd{abs}\hlstd{(model_1b}\hlopt{$}\hlstd{coefficients[}\hlnum{5}\hlstd{])),}
      \hlkwd{plnorm}\hlstd{(}\hlnum{0}\hlstd{, model_1b}\hlopt{$}\hlstd{coefficients[}\hlnum{2}\hlstd{],} \hlkwd{abs}\hlstd{(model_1b}\hlopt{$}\hlstd{coefficients[}\hlnum{6}\hlstd{])),}
      \hlkwd{pnorm}\hlstd{(}\hlnum{0}\hlstd{, model_1b}\hlopt{$}\hlstd{coefficients[}\hlnum{3}\hlstd{],} \hlkwd{abs}\hlstd{(model_1b}\hlopt{$}\hlstd{coefficients[}\hlnum{7}\hlstd{])),}
      \hlkwd{plnorm}\hlstd{(}\hlnum{0}\hlstd{, model_1b}\hlopt{$}\hlstd{coefficients[}\hlnum{4}\hlstd{],} \hlkwd{abs}\hlstd{(model_1b}\hlopt{$}\hlstd{coefficients[}\hlnum{8}\hlstd{])))} \hlopt{%>%}
  \hlkwd{setNames}\hlstd{(}\hlkwd{c}\hlstd{(}\hlstr{'apple'}\hlstd{,} \hlstr{'storage'}\hlstd{,} \hlstr{'screen'}\hlstd{,} \hlstr{'price'}\hlstd{))}
\end{alltt}
\begin{verbatim}
##     apple   storage    screen     price 
## 0.3706285 1.0000000 0.7690148 1.0000000
\end{verbatim}
\end{kframe}
\end{knitrout}

	The interpretation of the parameter estimates for this model is roughly the same as in (a). We now model $\beta_1$ and $\beta_3$ as log-normal distributions, however, so any significant variation in these coefficients occurs only on the positive side. Coefficients $\beta_0$ and $\beta_2$ still have substantial mass on both the positive and negative sides, which has intuitive appeal for the reasons described above. Since we model $\beta_1$ and $\beta_3$ using log-normal distributions, these coefficients are now positive for everyone, which is more intuitive and corrects the issues described above. Technically, however, we can interpret coefficient $\beta_3$ as negative for the entire population because we transformed the price data to be negative, making the positive coefficients effectively negative coefficients.

	\item We could use the model in (b) to calculate how consumers value the Apple brand, storage, and screen size, but it would require taking a ratio of distributions. To make these calculations easier, we can model price as having a fixed coefficient. Again model this purchase as a mixed logit model with the same underlying utility model as in (a) and (b). That is, the representative utility for alternative $j$ is
	$$V_{nj} = \beta_0 Apple_j + \beta_1 GB_j + \beta_2 SS_j + \beta_3 p_j$$
	where $Apple_j$ is a dummy variable if alternative $j$ is from Apple, $GB_j$ is the internal storage of alternative $j$, $SS_j$ is the diagonal screen size of alternative $j$, and $p_j$ is the price of alternative $j$. Model $\beta_0$ and $\beta_2$ as having a normal distribution, $\beta_1$ as having a log-normal distribution, and $\beta_3$ as a fixed coefficient. Estimate this mixed logit model using the \texttt{mlogit()} function in R; use 100 draws for simulation (\texttt{R = 100}) and set a seed of 703 for replication (\texttt{seed = 703}).
	\begin{enumerate}[label=\roman*.]
		\item Report your parameter estimates, standard errors, z-stats, and p-values. Briefly interpret these results. 
		\item Calculate the value consumers place on the Apple brand, each gigabyte of internal storage, and each 0.1 inch of diagonal screen size. Because we have distributions for $\beta_0$, $\beta_1$, and $\beta_2$, these values will also be distributions. Report the parameters that define these distributions. That is, for the value of the Apple brand and the value of each 0.1 inch of diagonal screen size, report the mean and standard deviation of the value; for the value of each gigabyte of internal storage, report the mean and standard deviation of the underlying normal distribution from which the log-normal distribution is derived.
	\end{enumerate}

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlcom{### Part c}
\hlcom{## Convert dataset to mlogit format}
\hlstd{data_1c} \hlkwb{<-} \hlstd{data_1} \hlopt{%>%}
  \hlkwd{mlogit.data}\hlstd{(}\hlkwc{shape} \hlstd{=} \hlstr{'long'}\hlstd{,} \hlkwc{choice} \hlstd{=} \hlstr{'purchase'}\hlstd{,} \hlkwc{alt.var} \hlstd{=} \hlstr{'phone_id'}\hlstd{)}
\end{alltt}


{\ttfamily\noindent\color{warningcolor}{\#\# Warning: Setting row names on a tibble is deprecated.}}\begin{alltt}
\hlcom{## Model phone purchase as a mixed logit with random coefficients but}
\hlcom{## fixed price coefficient}
\hlstd{model_1c} \hlkwb{<-} \hlstd{data_1c} \hlopt{%>%}
  \hlkwd{mlogit}\hlstd{(purchase} \hlopt{~} \hlstd{apple} \hlopt{+} \hlstd{storage} \hlopt{+} \hlstd{screen} \hlopt{+} \hlstd{price} \hlopt{|} \hlnum{0} \hlopt{|} \hlnum{0}\hlstd{,} \hlkwc{data} \hlstd{= .,}
         \hlkwc{rpar} \hlstd{=} \hlkwd{c}\hlstd{(}\hlkwc{apple} \hlstd{=} \hlstr{'n'}\hlstd{,} \hlkwc{storage} \hlstd{=} \hlstr{'ln'}\hlstd{,} \hlkwc{screen} \hlstd{=} \hlstr{'n'}\hlstd{),}
         \hlkwc{R} \hlstd{=} \hlnum{100}\hlstd{,} \hlkwc{seed} \hlstd{=} \hlnum{703}\hlstd{)}
\hlcom{## Summarize model results}
\hlstd{model_1c} \hlopt{%>%}
  \hlkwd{summary}\hlstd{()}
\end{alltt}
\begin{verbatim}
## 
## Call:
## mlogit(formula = purchase ~ apple + storage + screen + price | 
##     0 | 0, data = ., rpar = c(apple = "n", storage = "ln", screen = "n"), 
##     R = 100, seed = 703)
## 
## Frequencies of alternatives:
##     1     2     3     4     5     6     7     8     9    10 
## 0.073 0.008 0.078 0.005 0.208 0.355 0.009 0.081 0.014 0.169 
## 
## bfgs method
## 24 iterations, 0h:0m:15s 
## g'(-H)^-1g = 8.38E-07 
## gradient close to zero 
## 
## Coefficients :
##              Estimate Std. Error  z-value  Pr(>|z|)    
## apple      -0.1566701  0.2380459  -0.6582    0.5104    
## storage    -4.2061132  0.0747870 -56.2412 < 2.2e-16 ***
## screen      3.6675156  0.4142715   8.8529 < 2.2e-16 ***
## price      -0.0141172  0.0010967 -12.8727 < 2.2e-16 ***
## sd.apple    0.6787496  0.6674151   1.0170    0.3092    
## sd.storage  0.6085495  0.0580973  10.4747 < 2.2e-16 ***
## sd.screen  -5.0153374  0.8154579  -6.1503 7.732e-10 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Log-Likelihood: -1801.5
## 
## random coefficients
##         Min.      1st Qu.      Median        Mean    3rd Qu. Max.
## apple   -Inf -0.614479794 -0.15667012 -0.15667012 0.30113956  Inf
## storage    0  0.009886614  0.01490419  0.01793597 0.02246824  Inf
## screen  -Inf  0.284721895  3.66751558  3.66751558 7.05030927  Inf
\end{verbatim}
\begin{alltt}
\hlcom{## Calculate distirbuiton of the value of brand preference}
\hlkwd{c}\hlstd{(model_1c}\hlopt{$}\hlstd{coefficients[}\hlnum{1}\hlstd{]} \hlopt{/ -}\hlstd{model_1c}\hlopt{$}\hlstd{coefficients[}\hlnum{4}\hlstd{],}
  \hlkwd{abs}\hlstd{(model_1c}\hlopt{$}\hlstd{coefficients[}\hlnum{5}\hlstd{])} \hlopt{/ -}\hlstd{model_1c}\hlopt{$}\hlstd{coefficients[}\hlnum{4}\hlstd{])} \hlopt{%>%}
  \hlkwd{setNames}\hlstd{(}\hlkwd{c}\hlstd{(}\hlstr{'apple'}\hlstd{,} \hlstr{'sd.apple'}\hlstd{))}
\end{alltt}
\begin{verbatim}
##     apple  sd.apple 
## -11.09782  48.07962
\end{verbatim}
\begin{alltt}
\hlcom{## Calculate distirbuiton of the value of storage}
\hlkwd{c}\hlstd{(model_1c}\hlopt{$}\hlstd{coefficients[}\hlnum{2}\hlstd{]} \hlopt{-} \hlkwd{log}\hlstd{(}\hlopt{-}\hlstd{model_1c}\hlopt{$}\hlstd{coefficients[}\hlnum{4}\hlstd{]),}
  \hlkwd{abs}\hlstd{(model_1c}\hlopt{$}\hlstd{coefficients[}\hlnum{6}\hlstd{]))} \hlopt{%>%}
  \hlkwd{setNames}\hlstd{(}\hlkwd{c}\hlstd{(}\hlstr{'storage'}\hlstd{,} \hlstr{'sd.storage'}\hlstd{))}
\end{alltt}
\begin{verbatim}
##    storage sd.storage 
## 0.05424812 0.60854953
\end{verbatim}
\begin{alltt}
\hlcom{## Calculate distirbuiton of the value of screen size}
\hlkwd{c}\hlstd{(model_1c}\hlopt{$}\hlstd{coefficients[}\hlnum{3}\hlstd{]} \hlopt{/ -}\hlstd{model_1c}\hlopt{$}\hlstd{coefficients[}\hlnum{4}\hlstd{]} \hlopt{*} \hlnum{0.1}\hlstd{,}
  \hlkwd{abs}\hlstd{(model_1c}\hlopt{$}\hlstd{coefficients[}\hlnum{7}\hlstd{])} \hlopt{/ -}\hlstd{model_1c}\hlopt{$}\hlstd{coefficients[}\hlnum{4}\hlstd{]} \hlopt{*} \hlnum{0.01}\hlstd{)} \hlopt{%>%}
  \hlkwd{setNames}\hlstd{(}\hlkwd{c}\hlstd{(}\hlstr{'screen'}\hlstd{,} \hlstr{'sd.screen'}\hlstd{))}
\end{alltt}
\begin{verbatim}
##    screen sd.screen 
## 25.979056  3.552643
\end{verbatim}
\end{kframe}
\end{knitrout}

	The general interpretation of these parameter estimates is the same as in (b) because the standard deviation of $\beta_3$ was not previously significant and no other parameter estimates changed substantially. The value consumers place on an Apple phone, relative to a Google phone, is distributed normally with a mean of $-\$11$ and a standard deviation of $\$48$. The value consumers place on each gigabyte of internal storage is distributed log-normally such that its underlying normal distribution has a mean of $\$0.05$ and a standard deviation of $\$0.61$. The value consumers place on each 0.1 inch of diagonal screen size is distributed normally with a mean of $\$26$ and a standard deviation of $\$3.6$.

	\item Conduct a likelihood ratio test to compare the models in (b) and (c). Write down the null hypothesis that you are testing and describe this hypothesis in words. Conduct this likelihood ratio test using the function \texttt{lrtest()} in R. Do you reject your null hypothesis? What is the p-value of the test?

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlcom{### Part d}
\hlcom{## Conduct likelihood ratio test of the models in parts b and c}
\hlkwd{lrtest}\hlstd{(model_1c, model_1b)}
\end{alltt}
\begin{verbatim}
## Likelihood ratio test
## 
## Model 1: purchase ~ apple + storage + screen + price | 0 | 0
## Model 2: purchase ~ apple + storage + screen + price | 0 | 0
##   #Df  LogLik Df  Chisq Pr(>Chisq)  
## 1   7 -1801.5                       
## 2   8 -1799.5  1 3.9614    0.04656 *
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
\end{verbatim}
\end{kframe}
\end{knitrout}

	The null hypothesis we are testing is
	$$H_0 \text{: } \sigma_3 = 0$$
	where $\sigma_3$ is the standard deviation of the underlying normal distribution for coefficient $\beta_3$. That is, we are testing if $\beta_3$ is a fixed coefficient or a random coefficient. We reject this null hypothesis; the likelihood ratio test has a p-value of 0.047. Thus, we conclude that, even though this parameter was not significant in (b), allowing $\beta_3$ to be log-normally distributed statistically improves the fit of the model.

	\item Using the model in (c), calculate the mean coefficients for purchasers of each of the four Google phones. Use the function \texttt{fitted(type = `parameters')} in R to calculate mean coefficients for each consumer. Report these 12 mean coefficients (3 random coefficients $\times$ 4 Google phones). Describe and briefly interpret the patterns you observe in these coefficients.

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlcom{### Part e}
\hlcom{## Calculate individual-level coefficients}
\hlstd{coefficients_1e} \hlkwb{<-} \hlstd{model_1c} \hlopt{%>%}
  \hlkwd{fitted}\hlstd{(}\hlkwc{type} \hlstd{=} \hlstr{'parameters'}\hlstd{)}
\hlcom{## Calculate average coefficients for Google phone consumers}
\hlstd{data_1} \hlopt{%>%}
  \hlkwd{filter}\hlstd{(purchase} \hlopt{==} \hlnum{1}\hlstd{)} \hlopt{%>%}
  \hlkwd{select}\hlstd{(customer_id, phone, storage)} \hlopt{%>%}
  \hlkwd{rename}\hlstd{(}\hlkwc{storage_data} \hlstd{= storage)} \hlopt{%>%}
  \hlkwd{cbind}\hlstd{(coefficients_1e)} \hlopt{%>%}
  \hlkwd{group_by}\hlstd{(phone, storage_data)} \hlopt{%>%}
  \hlkwd{summarize}\hlstd{(}\hlkwc{apple} \hlstd{=} \hlkwd{mean}\hlstd{(apple)} \hlopt{/ -}\hlstd{model_1c}\hlopt{$}\hlstd{coefficients[}\hlnum{4}\hlstd{],}
            \hlkwc{storage} \hlstd{=} \hlkwd{mean}\hlstd{(storage)} \hlopt{/ -}\hlstd{model_1c}\hlopt{$}\hlstd{coefficients[}\hlnum{4}\hlstd{],}
            \hlkwc{screen} \hlstd{=} \hlkwd{mean}\hlstd{(screen)} \hlopt{/ -}\hlstd{model_1c}\hlopt{$}\hlstd{coefficients[}\hlnum{4}\hlstd{]} \hlopt{*} \hlnum{0.1}\hlstd{)} \hlopt{%>%}
  \hlkwd{ungroup}\hlstd{()} \hlopt{%>%}
  \hlkwd{slice}\hlstd{(}\hlnum{1}\hlopt{:}\hlnum{4}\hlstd{)} \hlopt{%>%}
  \hlkwd{rename}\hlstd{(}\hlkwc{apple_coef} \hlstd{= apple,}
         \hlkwc{storage_coef} \hlstd{= storage,}
         \hlkwc{screen_coef} \hlstd{= screen,}
         \hlkwc{storage} \hlstd{= storage_data)}
\end{alltt}
\begin{verbatim}
## # A tibble: 4 x 5
##   phone             storage apple_coef storage_coef screen_coef
##   <chr>               <dbl>      <dbl>        <dbl>       <dbl>
## 1 Google Pixel 4         64     -0.430       0.0112       -2.20
## 2 Google Pixel 4        128     -0.433       0.0132       -1.79
## 3 Google Pixel 4 XL      64     -0.465       0.0105        6.94
## 4 Google Pixel 4 XL     128     -0.490       0.0115        6.97
\end{verbatim}
\end{kframe}
\end{knitrout}

	These mean coefficients for consumers of Google phones have intuitive appeal. Consumers who purchase Google phones have a preference for Google phones; that is, the coefficient on the Apple brand variable, $\beta_0$, is negative. Consumers who purchase phones with 64 GB of internal storage place a lower value on internal storage than the consumers who purchase phones with 128 GB of internal storage. Consumers who purchase the Google Pixel 4, which has a smaller screen size, place a negative value on screen size; consumers who purchase the larger Google Pixel 4 XL place a positive value on screen size.
\end{enumerate}

\section*{Problem 2: Simulation-Based Estimation}

\begin{enumerate}[label=\alph*., leftmargin=*]
	\item Model the purchase of a phone as in (c) of problem 1. That is, the representative utility for alternative $j$ is
	$$V_{nj} = \beta_0 Apple_j + \beta_1 GB_j + \beta_2 SS_j + \beta_3 p_j$$
	where $Apple_j$ is a dummy variable if alternative $j$ is from Apple, $GB_j$ is the internal storage of alternative $j$, $SS_j$ is the diagonal screen size of alternative $j$, and $p_j$ is the price of alternative $j$. Model $\beta_0$ and $\beta_2$ as having a normal distribution, $\beta_1$ as having a log-normal distribution, and $\beta_3$ as a fixed coefficient. Estimate the parameters of this model by maximum simulated likelihood estimation; use 100 draws for your simulation and set a seed of 703 for replication. The following steps can provide a rough guide to creating your own maximum simulated likelihood estimator:
	\begin{enumerate}[label=\Roman*.]
		\item Set a seed of 703 for replication.
		\item Draw 300,000 standard normal random variables (3 random coefficients $\times$ 100 draws $\times$ 1000 consumers).
		\item Create a function to simulate choice probabilities for one consumer:
		\begin{enumerate}[label=\roman*.]
			\item The function should take a set of parameters, the random draws for one consumer, and the data for one consumer as inputs: \texttt{function(parameters, draws, data)}.
			\item Transform the standard normal draws into the correct distributions using the distribution parameters.
			\item Calculate the representative utility for each alternative for each draw.
			\item Calculate the conditional choice probability for each alternative for each draw.
			\item Calculate the simulated choice probability for each alternative as the mean over all draws.
		\end{enumerate}
		\item Create a function to calculate simulated log-likelihood:
		\begin{enumerate}[label=\roman*.]
			\item The function should take a set of parameters, the random draws for all consumers, and the data for all consumers as inputs: \texttt{function(parameters, draws, data)}.
			\item Simulate choice probabilities for each alternative for each consumer (call your previous function for each consumer).
			\item Sum the log of the simulated choice probability for each consumer's chosen alternative.
			\item Return the negative of the log of simulated likelihood.
		\end{enumerate}
		\item Maximize the simulated log-likelihood (or minimize its negative) using \texttt{optim()}. Use the parameters from (c) in problem 1 as your starting guesses to speed up convergence. Your call of the \texttt{optim()} function may look something like:
		\begin{align*}
			&\text{\texttt{optim(par = c(model\_1c\$coefficients), fn = your\_second\_function,}} \\
			& \qquad \quad \; \text{\texttt{data = your\_data, draws = your\_draws,}} \\
			& \qquad \quad \; \text{\texttt{method = `BFGS', hessian = TRUE)}}
		\end{align*}
	\end{enumerate}
	Report your parameter estimates, standard errors, z-stats, and p-values. Briefly interpret these results.

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlcom{### Part a}
\hlcom{## Set seed for replication}
\hlkwd{set.seed}\hlstd{(}\hlnum{703}\hlstd{)}
\hlcom{## Draw standard normal random variables and split into list}
\hlstd{draws_2_list} \hlkwb{<-} \hlnum{1}\hlopt{:}\hlnum{1000} \hlopt{%>%}
  \hlkwd{map}\hlstd{(.,} \hlopt{~} \hlkwd{tibble}\hlstd{(}\hlkwc{apple_coef} \hlstd{=} \hlkwd{rnorm}\hlstd{(}\hlnum{100}\hlstd{),}
                  \hlkwc{storage_coef} \hlstd{=} \hlkwd{rnorm}\hlstd{(}\hlnum{100}\hlstd{),}
                  \hlkwc{screen_coef} \hlstd{=} \hlkwd{rnorm}\hlstd{(}\hlnum{100}\hlstd{)))}
\hlcom{## Split data into list by customer}
\hlstd{data_2_list} \hlkwb{<-} \hlstd{data_1} \hlopt{%>%}
  \hlkwd{group_by}\hlstd{(customer_id)} \hlopt{%>%}
  \hlkwd{group_split}\hlstd{()}
\hlcom{## Function to simulate choice probabilities for one individual}
\hlstd{simulate_probabilities} \hlkwb{<-} \hlkwa{function}\hlstd{(}\hlkwc{parameters}\hlstd{,} \hlkwc{draws}\hlstd{,} \hlkwc{data}\hlstd{)\{}
  \hlcom{## Select relevant variables and convert into a matrix}
  \hlstd{data_matrix} \hlkwb{<-} \hlstd{data} \hlopt{%>%}
    \hlkwd{select}\hlstd{(apple, storage, screen, price)} \hlopt{%>%}
    \hlkwd{as.matrix}\hlstd{()}
  \hlcom{## Transform random coefficients based on parameters}
  \hlstd{coefficients} \hlkwb{<-} \hlstd{draws} \hlopt{%>%}
    \hlkwd{mutate}\hlstd{(}\hlkwc{apple_coef} \hlstd{= parameters[}\hlnum{1}\hlstd{]} \hlopt{+} \hlstd{parameters[}\hlnum{5}\hlstd{]} \hlopt{*} \hlstd{apple_coef,}
           \hlkwc{storage_coef} \hlstd{=} \hlkwd{exp}\hlstd{(parameters[}\hlnum{2}\hlstd{]} \hlopt{+} \hlstd{parameters[}\hlnum{6}\hlstd{]} \hlopt{*} \hlstd{storage_coef),}
           \hlkwc{screen_coef} \hlstd{= parameters[}\hlnum{3}\hlstd{]} \hlopt{+} \hlstd{parameters[}\hlnum{7}\hlstd{]} \hlopt{*} \hlstd{screen_coef,}
           \hlkwc{price_coef} \hlstd{= parameters[}\hlnum{4}\hlstd{])}
  \hlcom{## Calculate utility for each alternative in each draw}
  \hlstd{utility} \hlkwb{<-} \hlstd{(}\hlkwd{as.matrix}\hlstd{(coefficients)} \hlopt{%*%} \hlkwd{t}\hlstd{(data_matrix))} \hlopt{%>%}
    \hlkwd{pmin}\hlstd{(}\hlnum{700}\hlstd{)} \hlopt{%>%}
    \hlkwd{pmax}\hlstd{(}\hlopt{-}\hlnum{700}\hlstd{)}
  \hlcom{## Sum the exponential of utility over alternatives}
  \hlstd{summed_utility} \hlkwb{<-} \hlstd{utility} \hlopt{%>%}
    \hlkwd{exp}\hlstd{()} \hlopt{%>%}
    \hlkwd{rowSums}\hlstd{()}
  \hlcom{## Calculate the conditional probability for each alternative in each draw}
  \hlstd{conditional_probability} \hlkwb{<-} \hlkwd{exp}\hlstd{(utility)} \hlopt{/} \hlstd{summed_utility}
  \hlcom{## Average conditional probabilities over all draws}
  \hlstd{simulated_probability} \hlkwb{<-} \hlkwd{colMeans}\hlstd{(conditional_probability)}
  \hlcom{## Add simulated probability to initial dataset}
  \hlstd{data_out} \hlkwb{<-} \hlstd{data} \hlopt{%>%}
    \hlkwd{mutate}\hlstd{(}\hlkwc{probability} \hlstd{= simulated_probability)}
  \hlcom{## Return initial dataset with simulated probability variable}
  \hlkwd{return}\hlstd{(data_out)}
\hlstd{\}}
\hlcom{## Function to calculate simulated log-likelihood}
\hlstd{simulate_log_likelihood} \hlkwb{<-} \hlkwa{function}\hlstd{(}\hlkwc{parameters}\hlstd{,} \hlkwc{draws_list}\hlstd{,} \hlkwc{data_list}\hlstd{)\{}
  \hlcom{## Simulate probabilities for each individual}
  \hlstd{data} \hlkwb{<-} \hlkwd{map2}\hlstd{(}\hlkwc{.x} \hlstd{= draws_list,} \hlkwc{.y} \hlstd{= data_list,}
               \hlkwc{.f} \hlstd{=} \hlopt{~} \hlkwd{simulate_probabilities}\hlstd{(}\hlkwc{parameters} \hlstd{= parameters,}
                                             \hlkwc{draws} \hlstd{= .x,}
                                             \hlkwc{data} \hlstd{= .y))}
  \hlcom{## Combine individual datasets into one}
  \hlstd{data} \hlkwb{<-} \hlstd{data} \hlopt{%>%}
    \hlkwd{bind_rows}\hlstd{()}
  \hlcom{## Calcule the log of simulated probability for the chosen alternative}
  \hlstd{data} \hlkwb{<-} \hlstd{data} \hlopt{%>%}
    \hlkwd{filter}\hlstd{(purchase} \hlopt{==} \hlnum{1}\hlstd{)} \hlopt{%>%}
    \hlkwd{mutate}\hlstd{(}\hlkwc{log_probability} \hlstd{=} \hlkwd{log}\hlstd{(probability))}
  \hlcom{## Calculate the simulated log-likelihood}
  \hlstd{simulated_log_likelihood} \hlkwb{<-} \hlkwd{sum}\hlstd{(data}\hlopt{$}\hlstd{log_probability)}
  \hlcom{## Return the negative of simulated log-likelihood}
  \hlkwd{return}\hlstd{(}\hlopt{-}\hlstd{simulated_log_likelihood)}
\hlstd{\}}
\hlcom{## Maximize the log-likelihood function}
\hlstd{model_2a} \hlkwb{<-} \hlkwd{optim}\hlstd{(}\hlkwc{par} \hlstd{=} \hlkwd{c}\hlstd{(model_1c}\hlopt{$}\hlstd{coefficients),} \hlkwc{fn} \hlstd{= simulate_log_likelihood,}
                  \hlkwc{draws_list} \hlstd{= draws_2_list,} \hlkwc{data_list} \hlstd{= data_2_list,}
                  \hlkwc{method} \hlstd{=} \hlstr{'BFGS'}\hlstd{,} \hlkwc{hessian} \hlstd{=} \hlnum{TRUE}\hlstd{)}
\hlcom{## Function to summarize MLE model results}
\hlstd{summarize_mle} \hlkwb{<-} \hlkwa{function}\hlstd{(}\hlkwc{model}\hlstd{,} \hlkwc{names}\hlstd{)\{}
  \hlcom{## Extract model parameter estimates}
  \hlstd{parameters} \hlkwb{<-} \hlstd{model}\hlopt{$}\hlstd{par}
  \hlcom{## Calculate parameters standard errors}
  \hlstd{std_errors} \hlkwb{<-} \hlstd{model}\hlopt{$}\hlstd{hessian} \hlopt{%>%}
    \hlkwd{solve}\hlstd{()} \hlopt{%>%}
    \hlkwd{diag}\hlstd{()} \hlopt{%>%}
    \hlkwd{sqrt}\hlstd{()}
  \hlcom{## Calculate parameter z-stats}
  \hlstd{z_stats} \hlkwb{<-} \hlstd{parameters} \hlopt{/} \hlstd{std_errors}
  \hlcom{## Calculate parameter p-values}
  \hlstd{p_values} \hlkwb{<-} \hlnum{2} \hlopt{*} \hlkwd{pnorm}\hlstd{(}\hlopt{-}\hlkwd{abs}\hlstd{(z_stats))}
  \hlcom{## Summarize results in a list}
  \hlstd{model_summary} \hlkwb{<-} \hlkwd{list}\hlstd{(}\hlkwc{names} \hlstd{= names,}
                        \hlkwc{parameters} \hlstd{= parameters,}
                        \hlkwc{std_errors} \hlstd{= std_errors,}
                        \hlkwc{z_stats} \hlstd{= z_stats,}
                        \hlkwc{p_values} \hlstd{= p_values)}
  \hlcom{## Return model_summary object}
  \hlkwd{return}\hlstd{(model_summary)}
\hlstd{\}}
\hlkwd{summarize_mle}\hlstd{(model_2a,} \hlkwd{names}\hlstd{(model_2a}\hlopt{$}\hlstd{par))}
\end{alltt}
\begin{verbatim}
## $names
## [1] "apple"      "storage"    "screen"     "price"      "sd.apple"  
## [6] "sd.storage" "sd.screen" 
## 
## $parameters
##        apple      storage       screen        price     sd.apple 
##  17.72903267  -3.08390682  10.49278588  -0.04632926 -23.30665124 
##   sd.storage    sd.screen 
##   0.41970092 -31.48371729 
## 
## $std_errors
##       apple     storage      screen       price    sd.apple  sd.storage 
## 2.602787686 0.051008925 1.071222578 0.001999235 2.730125846 0.032545053 
##   sd.screen 
## 0.510062042 
## 
## $z_stats
##      apple    storage     screen      price   sd.apple sd.storage  sd.screen 
##   6.811555 -60.458181   9.795150 -23.173493  -8.536841  12.895998 -61.725270 
## 
## $p_values
##         apple       storage        screen         price      sd.apple 
##  9.654906e-12  0.000000e+00  1.181219e-22 8.428251e-119  1.379407e-17 
##    sd.storage     sd.screen 
##  4.740884e-38  0.000000e+00
\end{verbatim}
\end{kframe}
\end{knitrout}

	Coefficients $\beta_0$ and $\beta_2$ are normally distributed with positive means and large standard deviations, indicating high variability in these coefficients throughout the population; that is, the utility generated by the Apple brand and the marginal utility of screen size are positive on average but negative for many individuals. Coefficient $\beta_1$ is log-normally distributed, with the distribution defined by the parameters above, forcing everyone to have a positive marginal utility of internal storage. Coefficient $\beta_3$ is fixed and negative, indicating a positive marginal utility of income.

	\item Using the model in (a), calculate the mean coefficients for purchasers of each of the four Google phones. Use the same simulation draws as in (a) to simulate the mean coefficients for each consumer, and then average over all purchasers for each Google phone. The following steps can provide a rough guide to simulating coefficients:
	\begin{enumerate}[label=\Roman*.]
		\item Create a function to simulate mean coefficients for one consumer:
		\begin{enumerate}[label=\roman*.]
			\item The function should take a set of parameters, the random draws for one consumer, and the data for one consumer as inputs: \texttt{function(parameters, draws, data)}.
			\item Transform the standard normal draws into the correct distributions using the distribution parameters.
			\item Calculate the representative utility for each alternative for each draw.
			\item Calculate the conditional choice probability of the chosen alternative for each draw.
			\item Calculate the weighted average for each coefficient with weights equal to the conditional choice probability of the chosen alternative for that simulation draw.
		\end{enumerate}
		\item Simulate mean coefficients for each consumer (call your previous function for each consumer).
		\item For each of the four Google phones, average the simulated mean coefficients for all purchasers of that phone.
	\end{enumerate}
	Report these 12 mean coefficients (3 random coefficients $\times$ 4 Google phones). Describe and briefly interpret the patterns you observe in these coefficients.

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlcom{### Part b}
\hlcom{## Function to simulate individual coefficients for one individual}
\hlstd{simulate_coefficients} \hlkwb{<-} \hlkwa{function}\hlstd{(}\hlkwc{parameters}\hlstd{,} \hlkwc{draws}\hlstd{,} \hlkwc{data}\hlstd{)\{}
  \hlcom{## Select relevant variables and convert into a matrix}
  \hlstd{data_matrix} \hlkwb{<-} \hlstd{data} \hlopt{%>%}
    \hlkwd{select}\hlstd{(apple, storage, screen, price)} \hlopt{%>%}
    \hlkwd{as.matrix}\hlstd{()}
  \hlcom{## Transform random coefficients based on parameters}
  \hlstd{coefficients} \hlkwb{<-} \hlstd{draws} \hlopt{%>%}
    \hlkwd{mutate}\hlstd{(}\hlkwc{apple_coef} \hlstd{= parameters[}\hlnum{1}\hlstd{]} \hlopt{+} \hlstd{parameters[}\hlnum{5}\hlstd{]} \hlopt{*} \hlstd{apple_coef,}
           \hlkwc{storage_coef} \hlstd{=} \hlkwd{exp}\hlstd{(parameters[}\hlnum{2}\hlstd{]} \hlopt{+} \hlstd{parameters[}\hlnum{6}\hlstd{]} \hlopt{*} \hlstd{storage_coef),}
           \hlkwc{screen_coef} \hlstd{= parameters[}\hlnum{3}\hlstd{]} \hlopt{+} \hlstd{parameters[}\hlnum{7}\hlstd{]} \hlopt{*} \hlstd{screen_coef,}
           \hlkwc{price_coef} \hlstd{= parameters[}\hlnum{4}\hlstd{])} \hlopt{%>%}
    \hlkwd{select}\hlstd{(apple_coef, storage_coef, screen_coef, price_coef)}
  \hlcom{## Calculate utility for each alternative in each draw}
  \hlstd{utility} \hlkwb{<-} \hlstd{(}\hlkwd{as.matrix}\hlstd{(coefficients)} \hlopt{%*%} \hlkwd{t}\hlstd{(data_matrix))} \hlopt{%>%}
    \hlkwd{pmin}\hlstd{(}\hlnum{700}\hlstd{)} \hlopt{%>%}
    \hlkwd{pmax}\hlstd{(}\hlopt{-}\hlnum{700}\hlstd{)}
  \hlcom{## Sum the exponential of utility over alternatives}
  \hlstd{summed_utility} \hlkwb{<-} \hlstd{utility} \hlopt{%>%}
    \hlkwd{exp}\hlstd{()} \hlopt{%>%}
    \hlkwd{rowSums}\hlstd{()}
  \hlcom{## Calculate the conditional probability for each alternative in each draw}
  \hlstd{conditional_probability} \hlkwb{<-} \hlkwd{exp}\hlstd{(utility)} \hlopt{/} \hlstd{summed_utility}
  \hlcom{## Extract conditional probabilities of chosen alternative for each draw}
  \hlstd{probability_draw} \hlkwb{<-} \hlstd{conditional_probability} \hlopt{%*%} \hlstd{data}\hlopt{$}\hlstd{purchase}
  \hlcom{## Add draw probability to dataset of coefficients}
  \hlstd{coefficients} \hlkwb{<-} \hlstd{coefficients} \hlopt{%>%}
    \hlkwd{mutate}\hlstd{(}\hlkwc{probability} \hlstd{=} \hlkwd{c}\hlstd{(probability_draw))}
  \hlcom{## Calculate weighted average for each coefficient}
  \hlstd{coefficients_weighted} \hlkwb{<-} \hlstd{coefficients} \hlopt{%>%}
    \hlkwd{summarize}\hlstd{(}\hlkwc{apple_coef} \hlstd{=} \hlkwd{sum}\hlstd{(apple_coef} \hlopt{*} \hlstd{probability),}
              \hlkwc{storage_coef} \hlstd{=} \hlkwd{sum}\hlstd{(storage_coef} \hlopt{*} \hlstd{probability),}
              \hlkwc{screen_coef} \hlstd{=} \hlkwd{sum}\hlstd{(screen_coef} \hlopt{*} \hlstd{probability),}
              \hlkwc{probability} \hlstd{=} \hlkwd{sum}\hlstd{(probability))} \hlopt{%>%}
    \hlkwd{mutate}\hlstd{(}\hlkwc{apple_coef} \hlstd{= apple_coef} \hlopt{/} \hlstd{probability,}
           \hlkwc{storage_coef} \hlstd{= storage_coef} \hlopt{/} \hlstd{probability,}
           \hlkwc{screen_coef} \hlstd{= screen_coef} \hlopt{/} \hlstd{probability)} \hlopt{%>%}
    \hlkwd{select}\hlstd{(}\hlopt{-}\hlstd{probability)}
  \hlcom{## Add individual coefficients to initial dataset}
  \hlstd{data_out} \hlkwb{<-} \hlstd{data} \hlopt{%>%}
    \hlkwd{mutate}\hlstd{(}\hlkwc{apple_coef} \hlstd{= coefficients_weighted}\hlopt{$}\hlstd{apple_coef,}
           \hlkwc{storage_coef} \hlstd{= coefficients_weighted}\hlopt{$}\hlstd{storage_coef,}
           \hlkwc{screen_coef} \hlstd{= coefficients_weighted}\hlopt{$}\hlstd{screen_coef)}
  \hlcom{## Return initial dataset with simulated probability variable}
  \hlkwd{return}\hlstd{(data_out)}
\hlstd{\}}
\hlcom{## Calculate individual coefficients for each individual}
\hlstd{data_2b_list} \hlkwb{<-} \hlkwd{map2}\hlstd{(}\hlkwc{.x} \hlstd{= draws_2_list,} \hlkwc{.y} \hlstd{= data_2_list,}
                     \hlkwc{.f} \hlstd{=} \hlopt{~} \hlkwd{simulate_coefficients}\hlstd{(}\hlkwc{parameters} \hlstd{= model_2a}\hlopt{$}\hlstd{par,}
                                                  \hlkwc{draws} \hlstd{= .x,}
                                                  \hlkwc{data} \hlstd{= .y))}
\hlcom{## Combine list of data into one tibble}
\hlstd{data_2b} \hlkwb{<-} \hlstd{data_2b_list} \hlopt{%>%}
  \hlkwd{bind_rows}\hlstd{()}
\hlcom{## Calculate average coefficients for Google phone consumers}
\hlstd{data_2b} \hlopt{%>%}
  \hlkwd{filter}\hlstd{(purchase} \hlopt{==} \hlnum{1}\hlstd{)} \hlopt{%>%}
  \hlkwd{group_by}\hlstd{(phone, storage)} \hlopt{%>%}
  \hlkwd{summarize}\hlstd{(}\hlkwc{apple_coef} \hlstd{=} \hlkwd{mean}\hlstd{(apple_coef)} \hlopt{/ -}\hlstd{model_2a}\hlopt{$}\hlstd{par[}\hlnum{4}\hlstd{],}
            \hlkwc{storage_coef} \hlstd{=} \hlkwd{mean}\hlstd{(storage_coef)} \hlopt{/ -}\hlstd{model_2a}\hlopt{$}\hlstd{par[}\hlnum{4}\hlstd{],}
            \hlkwc{screen_coef} \hlstd{=} \hlkwd{mean}\hlstd{(screen_coef)} \hlopt{/ -}\hlstd{model_2a}\hlopt{$}\hlstd{par[}\hlnum{4}\hlstd{]} \hlopt{*} \hlnum{0.1}\hlstd{)} \hlopt{%>%}
  \hlkwd{ungroup}\hlstd{()} \hlopt{%>%}
  \hlkwd{slice}\hlstd{(}\hlnum{1}\hlopt{:}\hlnum{4}\hlstd{)}
\end{alltt}
\begin{verbatim}
## # A tibble: 4 x 5
##   phone             storage apple_coef storage_coef screen_coef
##   <chr>               <dbl>      <dbl>        <dbl>       <dbl>
## 1 Google Pixel 4         64      -272.        0.893       -49.8
## 2 Google Pixel 4        128      -318.        1.17        -51.7
## 3 Google Pixel 4 XL      64      -376.        0.862        73.0
## 4 Google Pixel 4 XL     128      -469.        1.26         71.8
\end{verbatim}
\end{kframe}
\end{knitrout}

	These mean coefficients for consumers of Google phones differ from those calculated in part (e) of problem 1, but they again have intuitive appeal. Consumers who purchase Google phones have a preference for Google phones; that is, the coefficient on the Apple brand variable, $\beta_0$, is negative. Consumers who purchase phones with 64 GB of internal storage place a lower value on internal storage than the consumers who purchase phones with 128 GB of internal storage. Consumers who purchase the Google Pixel 4, which has a smaller screen size, place a negative value on screen size; consumers who purchase the larger Google Pixel 4 XL place a positive value on screen size.

	\item As in the previous problem set, Apple is still interested in raising the price of the iPhone 11 with 256 GB. Using the model in (a), simulate the elasticity of each other phone with respect to the price of the iPhone 11 with 256 GB. The following steps can provide a rough guide to simulating elasticities:
	\begin{enumerate}[label=\Roman*.]
		\item Create a function to simulate elasticities for one consumer:
		\begin{enumerate}[label=\roman*.]
			\item The function should take a set of parameters, the random draws for one consumer, and the data for one consumer as inputs: \texttt{function(parameters, draws, data)}.
			\item Transform the standard normal draws into the correct distributions using the distribution parameters.
			\item Calculate the representative utility for each alternative for each draw.
			\item Calculate the conditional choice probability for each alternative for each draw.
			\item Calculate the simulated choice probability for each alternative as the mean over all draws.
			\item Calculate the term inside the integral of the elasticity formula for each alternative for each draw by taking products of conditional choice probabilities and the price coefficient.
			\item Simulate the integral in the elasticity formula by taking the mean of the previous values over all draws for each alternative.
			\item Calculate the elasticities by multiplying these simulated integrals by the price of the iPhone 11 with 256 GB and dividing by the simulated choice probability of the respective alternative.
		\end{enumerate}
		\item Simulate elasticities for each consumer (call your previous function for each consumer).
		\item Average each simulated elasticity over all consumers.
	\end{enumerate}
	Report these 10 elasticities. Briefly interpret these results.

\begin{knitrout}
\definecolor{shadecolor}{rgb}{0.969, 0.969, 0.969}\color{fgcolor}\begin{kframe}
\begin{alltt}
\hlcom{### Part c}
\hlcom{## Function to simulate elasticities for one individual}
\hlstd{simulate_elasticities} \hlkwb{<-} \hlkwa{function}\hlstd{(}\hlkwc{parameters}\hlstd{,} \hlkwc{draws}\hlstd{,} \hlkwc{data}\hlstd{)\{}
  \hlcom{## Select relevant variables and convert into a matrix}
  \hlstd{data_matrix} \hlkwb{<-} \hlstd{data} \hlopt{%>%}
    \hlkwd{select}\hlstd{(apple, storage, screen, price)} \hlopt{%>%}
    \hlkwd{as.matrix}\hlstd{()}
  \hlcom{## Transform random coefficients based on parameters}
  \hlstd{coefficients} \hlkwb{<-} \hlstd{draws} \hlopt{%>%}
    \hlkwd{mutate}\hlstd{(}\hlkwc{apple_coef} \hlstd{= parameters[}\hlnum{1}\hlstd{]} \hlopt{+} \hlstd{parameters[}\hlnum{5}\hlstd{]} \hlopt{*} \hlstd{apple_coef,}
           \hlkwc{storage_coef} \hlstd{=} \hlkwd{exp}\hlstd{(parameters[}\hlnum{2}\hlstd{]} \hlopt{+} \hlstd{parameters[}\hlnum{6}\hlstd{]} \hlopt{*} \hlstd{storage_coef),}
           \hlkwc{screen_coef} \hlstd{= parameters[}\hlnum{3}\hlstd{]} \hlopt{+} \hlstd{parameters[}\hlnum{7}\hlstd{]} \hlopt{*} \hlstd{screen_coef,}
           \hlkwc{price_coef} \hlstd{= parameters[}\hlnum{4}\hlstd{])}
  \hlcom{## Calculate utility for each alternative in each draw}
  \hlstd{utility} \hlkwb{<-} \hlstd{(}\hlkwd{as.matrix}\hlstd{(coefficients)} \hlopt{%*%} \hlkwd{t}\hlstd{(data_matrix))} \hlopt{%>%}
    \hlkwd{pmin}\hlstd{(}\hlnum{700}\hlstd{)} \hlopt{%>%}
    \hlkwd{pmax}\hlstd{(}\hlopt{-}\hlnum{700}\hlstd{)}
  \hlcom{## Sum the exponential of utility over alternatives}
  \hlstd{summed_utility} \hlkwb{<-} \hlstd{utility} \hlopt{%>%}
    \hlkwd{exp}\hlstd{()} \hlopt{%>%}
    \hlkwd{rowSums}\hlstd{()}
  \hlcom{## Calculate the conditional probability for each alternative in each draw}
  \hlstd{conditional_probability} \hlkwb{<-} \hlkwd{exp}\hlstd{(utility)} \hlopt{/} \hlstd{summed_utility}
  \hlcom{## Calculate simulated choice probabilities}
  \hlstd{simulated_probability} \hlkwb{<-} \hlkwd{colMeans}\hlstd{(conditional_probability)}
  \hlcom{## Calculate mean product of conditional probability for own elasticity}
  \hlstd{own_elasticity_integral} \hlkwb{<-} \hlkwd{mean}\hlstd{(conditional_probability[,} \hlnum{6}\hlstd{]} \hlopt{*}
                                    \hlstd{(}\hlnum{1} \hlopt{-} \hlstd{conditional_probability[,} \hlnum{6}\hlstd{]))} \hlopt{*}
    \hlkwd{unname}\hlstd{(model_2a}\hlopt{$}\hlstd{par[}\hlnum{4}\hlstd{])}
  \hlcom{## Calculate mean product of conditional probability for cross elasticities}
  \hlstd{cross_elasticity_integral} \hlkwb{<-} \hlkwd{colMeans}\hlstd{(conditional_probability[,} \hlnum{6}\hlstd{]} \hlopt{*}
                                          \hlstd{conditional_probability[,} \hlopt{-}\hlnum{6}\hlstd{])} \hlopt{*}
    \hlstd{model_2a}\hlopt{$}\hlstd{par[}\hlnum{4}\hlstd{]}
  \hlcom{## Combine elasticity integrals into one vector}
  \hlstd{elasticity_integral} \hlkwb{<-} \hlkwd{c}\hlstd{(cross_elasticity_integral[}\hlnum{1}\hlopt{:}\hlnum{5}\hlstd{],}
                           \hlstd{own_elasticity_integral,}
                           \hlstd{cross_elasticity_integral[}\hlnum{6}\hlopt{:}\hlnum{9}\hlstd{])}
  \hlcom{## Calculate own-price and cross-price simulated elasticities}
  \hlstd{simulated_elasticity} \hlkwb{<-} \hlkwd{c}\hlstd{(}\hlkwd{rep}\hlstd{(}\hlopt{-}\hlnum{1}\hlstd{,} \hlnum{5}\hlstd{),} \hlnum{1}\hlstd{,} \hlkwd{rep}\hlstd{(}\hlopt{-}\hlnum{1}\hlstd{,} \hlnum{4}\hlstd{))} \hlopt{*} \hlstd{data}\hlopt{$}\hlstd{price[}\hlnum{6}\hlstd{]} \hlopt{/}
    \hlstd{simulated_probability} \hlopt{*} \hlstd{elasticity_integral}
  \hlcom{## Add simulated elasticities to initial dataset}
  \hlstd{data_out} \hlkwb{<-} \hlstd{data} \hlopt{%>%}
    \hlkwd{mutate}\hlstd{(}\hlkwc{elasticity} \hlstd{= simulated_elasticity)}
  \hlcom{## Return initial dataset with simulated probability variable}
  \hlkwd{return}\hlstd{(data_out)}
\hlstd{\}}
\hlcom{## Simulate elasticities for each individual}
\hlstd{data_2c_list} \hlkwb{<-} \hlkwd{map2}\hlstd{(}\hlkwc{.x} \hlstd{= draws_2_list,} \hlkwc{.y} \hlstd{= data_2_list,}
                     \hlkwc{.f} \hlstd{=} \hlopt{~} \hlkwd{simulate_elasticities}\hlstd{(}\hlkwc{parameters} \hlstd{= model_2a}\hlopt{$}\hlstd{par,}
                                                  \hlkwc{draws} \hlstd{= .x,}
                                                  \hlkwc{data} \hlstd{= .y))}
\hlcom{## Combine list of data into one tibble}
\hlstd{data_2c} \hlkwb{<-} \hlstd{data_2c_list} \hlopt{%>%}
  \hlkwd{bind_rows}\hlstd{()}
\hlcom{## Calculate average elasticity with respect to price of iPhone 11 with 256 GB}
\hlstd{data_2c} \hlopt{%>%}
  \hlkwd{group_by}\hlstd{(phone, storage)} \hlopt{%>%}
  \hlkwd{summarize}\hlstd{(}\hlkwc{elasticity} \hlstd{=} \hlkwd{mean}\hlstd{(elasticity))} \hlopt{%>%}
  \hlkwd{ungroup}\hlstd{()}
\end{alltt}
\begin{verbatim}
## # A tibble: 10 x 3
##    phone             storage elasticity
##    <chr>               <dbl>      <dbl>
##  1 Google Pixel 4         64       1.10
##  2 Google Pixel 4        128       1.29
##  3 Google Pixel 4 XL      64       1.08
##  4 Google Pixel 4 XL     128       1.34
##  5 iPhone 11              64      12.4 
##  6 iPhone 11             256      -9.95
##  7 iPhone 11 Pro          64       5.44
##  8 iPhone 11 Pro         512       4.91
##  9 iPhone 11 Pro Max      64       1.55
## 10 iPhone 11 Pro Max     512       3.02
\end{verbatim}
\end{kframe}
\end{knitrout}

	The own-price elasticity of the iPhone 11 with 256 GB is nearly -10, indicating that consumers are highly price-responsive and many would substitute away from this phone if the price increases substantially. The cross-price elasticities of the Google phones with respect to the price of the iPhone 11 with 256 GB are all in the range of 1.08--1.34, suggesting few consumers would substitute across brands to the Google phones if Apple raises the price of the iPhone 11 with 256 GB. The largest cross-price elasticity is for the iPhone 11 with 64 GB, with an elasticity of 12.4, indicating many iPhone 11 consumers would substitute within model to less storage if Apple increases the price of the iPhone 11 with 256 GB. The remaining Apple phones have cross-price elasticities with respect to the price of the iPhone 11 with 256 GB of 1.55--5.44, larger than the Google phones but smaller than the iPhone 11 with 64 GB. These substitution patterns seem reasonable if consumers have strong brand and screen size preferences, as estimated by this model.
\end{enumerate}

\end{document}
